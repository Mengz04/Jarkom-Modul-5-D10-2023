# Jarkom-Modul-5-D10-2023

| Nama | NRP |
| ------- | ------- |
| Muhammad Rafi Insan Fillah | 5025211169  |
| Ken Anargya Alkausar | 5025211168  |

## Prerequisite
### Perhitungan VLSM
![VLSM](https://github.com/Mengz04/Jarkom-Modul-5-D10-2023/assets/78022264/b050989e-6a0e-4b86-a907-039fe040c4f3)

<table dir="ltr" border="1" cellspacing="0" cellpadding="0" data-sheets-root="1"><colgroup><col width="317" /><col width="100" /><col width="124" /><col width="123" /><col width="120" /><col width="186" /><col width="187" /><col width="212" /></colgroup>
<tbody>
<tr>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Route&quot;}">Route</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Subnet&quot;}">Subnet</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Network ID&quot;}">Network ID</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Netmask&quot;}">Netmask</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Broadcast&quot;}">Broadcast</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;IP 1&quot;}">IP 1</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;IP 2&quot;}">IP 2</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;IP 2&quot;}">IP 2</td>
</tr>
<tr>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Aura-Frieren&quot;}">Aura-Frieren</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;A1&quot;}">A1</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.128&quot;}">192.196.14.128</td>
<td data-sheets-value="{&quot;1&quot;:3,&quot;3&quot;:255255255252}" data-sheets-numberformat="{&quot;1&quot;:2,&quot;2&quot;:&quot;#,##0&quot;,&quot;3&quot;:1}">255.255.255.252</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.131&quot;}">192.196.14.131</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Aura = 192.196.14.129&quot;}">Aura = 192.196.14.129</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Frieren = 192.196.14.130&quot;}">Frieren = 192.196.14.130</td>
<td>&nbsp;</td>
</tr>
<tr>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Frieren-Himmel&quot;}">Frieren-Himmel</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;A2&quot;}">A2</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.132&quot;}">192.196.14.132</td>
<td data-sheets-value="{&quot;1&quot;:3,&quot;3&quot;:255255255252}" data-sheets-numberformat="{&quot;1&quot;:2,&quot;2&quot;:&quot;#,##0&quot;,&quot;3&quot;:1}">255.255.255.252</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.135&quot;}">192.196.14.135</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Frieren = 192.196.14.133&quot;}">Frieren = 192.196.14.133</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Himmel = 192.196.14.134&quot;}">Himmel = 192.196.14.134</td>
<td>&nbsp;</td>
</tr>
<tr>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Himmel-LaubHills&quot;}">Himmel-LaubHills</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;A3&quot;}">A3</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.12.0&quot;}">192.196.12.0</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;255.255.254.0&quot;}">255.255.254.0</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.13.255&quot;}">192.196.13.255</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Himmel = 192.196.12.1&quot;}">Himmel = 192.196.12.1</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;LaubHills = 192.196.12.2&quot;}">LaubHills = 192.196.12.2</td>
<td>&nbsp;</td>
</tr>
<tr>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Fern-Richter&quot;}">Fern-Richter</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;A4&quot;}">A4</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.136&quot;}">192.196.14.136</td>
<td data-sheets-value="{&quot;1&quot;:3,&quot;3&quot;:255255255252}" data-sheets-numberformat="{&quot;1&quot;:2,&quot;2&quot;:&quot;#,##0&quot;,&quot;3&quot;:1}">255.255.255.252</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.139&quot;}">192.196.14.139</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Fern = 192.196.14.137&quot;}">Fern = 192.196.14.137</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Richter = 192.196.14.138&quot;}">Richter = 192.196.14.138</td>
<td>&nbsp;</td>
</tr>
<tr>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Himmel-Switch1-Fern-Switch1-SchwerMountain&quot;}">Himmel-Switch1-Fern-Switch1-SchwerMountain</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;A5&quot;}">A5</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.0&quot;}">192.196.14.0</td>
<td data-sheets-value="{&quot;1&quot;:3,&quot;3&quot;:255255255128}" data-sheets-numberformat="{&quot;1&quot;:2,&quot;2&quot;:&quot;#,##0&quot;,&quot;3&quot;:1}">255.255.255.128</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.127&quot;}">192.196.14.127</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Himmel = 192.196.14.1&quot;}">Himmel = 192.196.14.1</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Fern = 192.196.14.2&quot;}">Fern = 192.196.14.2</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;SchwerMountain = 192.196.14.3&quot;}">SchwerMountain = 192.196.14.3</td>
</tr>
<tr>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Fern-Switch2-Revolte&quot;}">Fern-Switch2-Revolte</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;A6&quot;}">A6</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.140&quot;}">192.196.14.140</td>
<td data-sheets-value="{&quot;1&quot;:3,&quot;3&quot;:255255255252}" data-sheets-numberformat="{&quot;1&quot;:2,&quot;2&quot;:&quot;#,##0&quot;,&quot;3&quot;:1}">255.255.255.252</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.143&quot;}">192.196.14.143</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Fern = 192.196.14.141&quot;}">Fern = 192.196.14.141</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Revolte = 192.196.14.142&quot;}">Revolte = 192.196.14.142</td>
<td>&nbsp;</td>
</tr>
<tr>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Frieren-Stark&quot;}">Frieren-Stark</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;A7&quot;}">A7</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.144&quot;}">192.196.14.144</td>
<td data-sheets-value="{&quot;1&quot;:3,&quot;3&quot;:255255255252}" data-sheets-numberformat="{&quot;1&quot;:2,&quot;2&quot;:&quot;#,##0&quot;,&quot;3&quot;:1}">255.255.255.252</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.147&quot;}">192.196.14.147</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Frieren = 192.196.14.145&quot;}">Frieren = 192.196.14.145</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Stark =192.196.14.146&quot;}">Stark =192.196.14.146</td>
<td>&nbsp;</td>
</tr>
<tr>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Aura-Heiter&quot;}">Aura-Heiter</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;A8&quot;}">A8</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.148&quot;}">192.196.14.148</td>
<td data-sheets-value="{&quot;1&quot;:3,&quot;3&quot;:255255255252}" data-sheets-numberformat="{&quot;1&quot;:2,&quot;2&quot;:&quot;#,##0&quot;,&quot;3&quot;:1}">255.255.255.252</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.14.151&quot;}">192.196.14.151</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Aura = 192.196.14.149&quot;}">Aura = 192.196.14.149</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Heiter = 192.196.14.150&quot;}">Heiter = 192.196.14.150</td>
<td>&nbsp;</td>
</tr>
<tr>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Heiter-Switch3-GrobeForest-Switch3-Sein&quot;}">Heiter-Switch3-GrobeForest-Switch3-Sein</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;A9&quot;}">A9</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.8.0&quot;}">192.196.8.0</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;255.255.252.0&quot;}">255.255.252.0</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.11.255&quot;}">192.196.11.255</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Heiter = 192.196.8.1&quot;}">Heiter = 192.196.8.1</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Sein = 192.196.8.2&quot;}">Sein = 192.196.8.2</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;GrobeForest = 192.196.8.3&quot;}">GrobeForest = 192.196.8.3</td>
</tr>
<tr>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Heiter-TurkRegion&quot;}">Heiter-TurkRegion</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;A10&quot;}">A10</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.0.0&quot;}">192.196.0.0</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;255.255.248.0&quot;}">255.255.248.0</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;192.196.7.255&quot;}">192.196.7.255</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;Heiter = 192.196.0.1&quot;}">Heiter = 192.196.0.1</td>
<td data-sheets-value="{&quot;1&quot;:2,&quot;2&quot;:&quot;TurkRegion = 192.196.0.2&quot;}">TurkRegion = 192.196.0.2</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>

### Routing
Aura
```sh
#BAWAH
route add -net 192.196.14.132 netmask 255.255.255.252 gw 192.196.14.130 #A2 REF FRIE A1
route add -net 192.196.12.0 netmask 255.255.254.0 gw 192.196.14.130 #A3 REF FRIE A1
route add -net 192.196.14.136 netmask 255.255.255.252 gw 192.196.14.130 #A4 REF FRIE A1
route add -net 192.196.14.0 netmask 255.255.255.128 gw 192.196.14.130 #A5 REF FRIE A1
route add -net 192.196.14.140 netmask 255.255.255.252 gw 192.196.14.130 #A6 REF FRIE A1
route add -net 192.196.14.144 netmask 255.255.255.252 gw 192.196.14.130 #A7 REF FRIE A1

#KANAN
route add -net 192.196.8.0 netmask 255.255.252.0 gw 192.196.14.150 #A9 REF HEI A8
route add -net 192.196.0.0 netmask 255.255.248.0 gw 192.196.14.150 #A10 REF HEI A8
```

Fern
```sh
#NAIK
route add -net 0.0.0.0 netmask 0.0.0.0 gw 192.196.14.1
```

Frieren
```sh
#NAIK
route add -net 0.0.0.0 netmask 0.0.0.0 gw 192.196.14.129

#KIRI
route add -net 192.196.12.0 netmask 255.255.254.0 gw 192.196.14.134 #A3 REF HIMM A2
route add -net 192.196.14.136 netmask 255.255.255.252 gw 192.196.14.134 #A4 REF HIMM A2
route add -net 192.196.14.0 netmask 255.255.255.128 gw 192.196.14.134 #A5 REF HIMM A2
route add -net 192.196.14.140 netmask 255.255.255.252 gw 192.196.14.134 #A6 REF HIMM A2
```

Heiter
```sh
#NAIK
route add -net 0.0.0.0 netmask 0.0.0.0 gw 192.196.14.149
```

Himmel
```sh
#NAIK
route add -net 0.0.0.0 netmask 0.0.0.0 gw 192.196.14.129

#BAWAH
route add -net 192.196.14.136 netmask 255.255.255.252 gw 192.196.14.2 #A4 REF HIMM A2
route add -net 192.196.14.140 netmask 255.255.255.252 gw 192.196.14.2 #A6 REF FERN A5
```

### Setting DHCP
Revolte
```sh
echo '
subnet 192.196.14.140 netmask 255.255.255.252 {}

subnet 192.196.12.0 netmask 255.255.254.0 {}
subnet 192.196.14.0 netmask 255.255.255.128 {}
subnet 192.196.8.0 netmask 255.255.252.0 {}
subnet 192.196.0.0 netmask 255.255.248.0 {}

host LaubHills{
    hardware ethernet 6e:76:17:d0:27:e8;
    fixed-address 192.196.12.2;
}

host SchwerMountains{
    hardware ethernet ea:f6:65:34:86:39;
    fixed-address 192.196.14.3;
}

host GrobeForest{
    hardware ethernet c6:24:ad:58:cd:cb;
    fixed-address 192.196.8.2;
}

host TurkRegion{
    hardware ethernet e6:fa:f8:05:b9:39;
    fixed-address 192.196.0.2;
}

' > /etc/dhcp/dhcpd.conf

echo 'INTERFACESv4="eth0"' > /etc/default/isc-dhcp-server

service isc-dhcp-server start
```

## 1. Agar topologi yang kalian buat dapat mengakses keluar, kalian diminta untuk mengkonfigurasi Aura menggunakan iptables, tetapi tidak ingin menggunakan MASQUERADE

Aura
```sh
echo '
SERVERS="192.196.14.142"
INTERFACES="eth1 eth2"
OPTIONS=""
' > /etc/default/isc-dhcp-relay

echo 'net.ipv4.ip_forward=1' >  /etc/sysctl.conf

sysctl -p

ip_address=$(ip addr show eth0 | grep -oP '(?<=inet\s)\d+(\.\d+){3}')

# Display the assigned IP address
echo "Assigned IP address for eth0: $ip_address"

iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source $ip_address
```
Karena Aura menggunakan setting DHCP dinamis pada eth0 yang terhubung ke NAT1 (bawaan), maka diharuskan mendapat IP dari aura tersebut agar bisa didaftarkan sebagai source dari SNAT. Cara mendapatkan IP aura adalah dengan `ip_address=$(ip addr show eth0 | grep -oP '(?<=inet\s)\d+(\.\d+){3}')` yang nanti digunakan pada command `iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source $ip_address`.

## 2. Kalian diminta untuk melakukan drop semua TCP dan UDP kecuali port 8080 pada TCP.

Aura
```sh
# Drop all incoming TCP traffic
iptables -A INPUT -p tcp -j DROP
# Drop all incoming UDP traffic
iptables -A INPUT -p udp -j DROP

# Drop all outgoing TCP traffic
iptables -A OUTPUT -p tcp -j DROP
# Drop all outgoing UDP traffic
iptables -A OUTPUT -p udp -j DROP

# Allow incoming TCP traffic on port 8080
iptables -A INPUT -p tcp --dport 8080 -j ACCEPT
# Allow outgoing TCP traffic on port 8080
iptables -A OUTPUT -p tcp --sport 8080 -j ACCEPT

# Allow established and related connections
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
```

Dengan command iptables tersebut maka kita secara default akan `DROP` seluruh input dan output yang merupakan TCP dan UDP, Selanjutnya akan membuat pengecualian untuk TCP dengan port 8080.

## 3. Kepala Suku North Area meminta kalian untuk membatasi DHCP dan DNS Server hanya dapat dilakukan ping oleh maksimal 3 device secara bersamaan, selebihnya akan di drop.

Revolte & Richter
```sh
iptables -A INPUT -p icmp --icmp-type echo-request -m hashlimit --hashlimit-name dhcp_limit --hashlimit-mode dstip --hashlimit-upto 3/min --hashlimit-burst 3 -j ACCEPT

iptables -A INPUT -p icmp --icmp-type echo-request -j DROP
```

Dengan iptables tersebut maka akan limit 3 device yang dapat ping revolte dan richter dengan reset tiap menit.

## 4. Lakukan pembatasan sehingga koneksi SSH pada Web Server hanya dapat dilakukan oleh masyarakat yang berada pada GrobeForest.

Stark & Sein
```sh
# Allow SSH from a specific IP address during specific time window
iptables -A INPUT -p tcp --dport 22 -s 192.196.8.2 -m time --weekdays Mon,Tue,Wed,Thu,Fri --timestart 08:00 --timestop 16:00 -j ACCEPT

# Drop all other incoming SSH traffic
iptables -A INPUT -p tcp --dport 22 -j DROP

# Drop all incoming traffic outside Monday to Friday, 08:00-16:00
iptables -A INPUT -m time ! --weekdays Mon,Tue,Wed,Thu,Fri --timestart 08:00 --timestop 16:00 -j DROP

# Accept all other incoming traffic
iptables -A INPUT -j ACCEPT
```

Seting iptables tersebut berkaitan dengan soal nomor 5 yang membatasi waktu akses terhadap web server. Namun perlu dilihat bahwa kita ACCEPT TCP dengan port 22 (port untuk SSH) jika berasal dari IP 192.196.8.2 yang merupakan IP grobeforest.

## 5. Selain itu, akses menuju WebServer hanya diperbolehkan saat jam kerja yaitu Senin-Jumat pada pukul 08.00-16.00.

```sh
# Allow SSH from a specific IP address during specific time window
iptables -A INPUT -p tcp --dport 22 -s 192.196.8.2 -m time --weekdays Mon,Tue,Wed,Thu,Fri --timestart 08:00 --timestop 16:00 -j ACCEPT

# Drop all other incoming SSH traffic
iptables -A INPUT -p tcp --dport 22 -j DROP

# Drop all incoming traffic outside Monday to Friday, 08:00-16:00
iptables -A INPUT -m time ! --weekdays Mon,Tue,Wed,Thu,Fri --timestart 08:00 --timestop 16:00 -j DROP

# Accept all other incoming traffic
iptables -A INPUT -j ACCEPT
```

Dua command iptables pertama khusus mengatur jika akses adalah SSH dan 2 command berikutnya adalah selain akses SSH yang sama akan ACCEPT jika waktu akses di hari senin-jumat di jam 08.00 hingga 16.00.
